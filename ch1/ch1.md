# UNIX基础知识

## 登录

1. /etc/passwd中保存了用户、加密口令、用户ID、数字组ID、起始目录以及shell程序等
2. **shell**
   * shell是一种命令解释器，读取用户输入并执行命令，shell的输入一般**来自terminal，有时来自文件（shell脚本）**

## 文件和目录

1. 文件系统
   * 所有文件、目录的起点都是根（/）
   * **目录是一个包含目录项的文件，每个目录项都包含文件名以及说明文件属性的信息**
     * 文件属性有目录、普通文件
     * 文件大小
     * 文件所有者
     * 文件权限
     * 文件最后修改时间等
2. 文件名
   * 斜线和空字符不能出现在文件名中，**斜线用来分隔构成路径名的各文件名，空字符则用来终止一个路径名**
3. 路径名
   * 由斜线分隔的一个或多个文件名组成的序列构成路径名
   * 斜线开头的路径称为绝对路径
   * 否则为相对路径
4. 工作目录
   * 每个进程都有一个**工作目录（working directory）**，相对路径名从工作目录开始解释，可以用chdir改变工作目录



## 输入和输出

1. 文件描述符（file descriptor）

   * 内核用于标识一个特定的进程正在访问的文件

2. 标准输入、标准输出和标准错误（stdin stdout stderr）

   * 每当运行一个新程序时，shell为其打开3个fd，即**标准输入、标准输出、标准错误**

   * **不做特殊处理时，3个fd都指向terminal**

   * shell可以将描述符重定向到某个文件，例：

     ```
     ls > file.list
     ```

3. 不带缓冲的I/O

   * open read write lseek close提供了不带缓冲的IO，它们都使用文件描述符

4. 标准I/O
   * 为不带缓冲的I/O提供了一个带缓冲的接口



## 程序和进程

1. 有三个进程操纵函数：fork exec waitpid
   * execlp要求的参数是以null结束而不是换行符
   * fork后exec则可以产生一个新的进程 
2. 线程和线程id
   * **通常，一个进程中只有一个控制线程**
   * 一个进程内所有线程共享地址空间，文件描述符，栈以及与进程相关的属性
   * 线程也有ID标识，但线程ID仅在进程内有意义



## 出错处理

POSIX和ISO C将errno定义为一个符号，他扩展为一个可修改的整形左值（lvalue），在支持线程的环境中，多个进程共享地址空间，**每个进程都有属于他的局部errno**

```c
extern int *__errno_location(void);
#define errno (*__errno_location())
```

C标准定义了两个函数，它们用于打印出错信息

```c
char *strerror(int errnum); // 将errnum映射为char*
void perror(const char *msg); // 输出msg指向字符串并输出errno对应出错信息
```



## 信号

信号用于通知**进程**发生了某种情况，进程有以下3种处理信号的方式：

1. 忽略信号
2. 按系统默认方式处理信号
3. 提供一个函数信号发生时调用该函数，这被称为捕捉该信号

很多情况下会产生信号，除了使用键盘外，另外一种产生信号的方法是调用kill函数，在一个进程中调用该函数就可向另一个进程发送一个信号



## 系统调用与库函数

系统调用是程序向内核请求服务的入口，**是用c语言定义的，这和早期使用汇编定义的不同**

* UNIX使用的技术是为每个系统调用在C库中设置一个具有同样名字的函数，函数又用系统所要求的技术调用相应的内核服务
  * *例如：函数将一个或多个C参数送入通用寄存器，然后执行某个产生软中断进入内核的机器指令*
* 以malloc函数为例：UNIX系统调用中处理存储空间分配的是sbrk，他**按字节数增加或减少地址空间，如何管理却取决于进程**

